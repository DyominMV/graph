# Очередной поиск набора маршрутов по всем рёбрам ориентированного графа

Задача - построить набор маршрутов из заданных вершин, покрывающий все рёбра графа, так что суммарный вес рёбер, по которым проходят маршруты был минимальным.

Решение - полный перебор всех маршрутов.

## Каким боком тут полукольца

полукольцо - это множество с двумя ассоциативными действиями (сложение и умножение) и двумя нейтральными элементами (один нейтральный по сложению - ноль, второй - по умножению - один). 

В данной работе считаем, что $\forall a \Rightarrow 0 \times a = 0$

Матрицы размера $n \times n$, элементы которых принадлежат полукольцу, тоже образуют полукольца, причём по обычным правилам. 

Далее покажем что списки маршрутов на графе тоже образуют полукольцо

## Графы

В графе есть вершины и рёбра. Если с вершинами всё просто (достаточно запомнить её идентификатор), то с рёбрами всё иначе: нужно запоминать не только идентификатор, но и вершину в которую это ребро направлено. По хорошему надо ещё помнить из какой вершины ребро исходит, но поскольку она и так будет в качестве ключа в списке смежности, мы её опустим.

Получается что есть *Вершина*, есть *Ребро = вес + Вершина*. Можем теперь ввести *Маршрут* как начальную вершину и список рёбер. Соединение маршрутов может быть корректным (конец левого маршрута совпадает с началом правого) или некорректным. Чтобы это учесть функция соединения маршрутов возвращает Maybe. Также введём пустой маршрут- он ведёт себя как нейтральный элемент для соединения маршрутов.

Наконец, вводим *Набор маршрутов* - просто множество маршрутов, да. Определим теперь сложение и умножение:
- сложение: объединение маршрутов. Для избавления от маршрутов с лишними прохождениями по циклам используется дополнительная магия, но мякотка остаётся прежней.
- ноль: пустое множество маршрутов
- произведение - множество, образованное как соединение каждого маршрута из первого множества с каждым маршрутом из второго
- единица - множество состоящее из пустого маршрута (стоим на месте)

## Про полукольцо графовых матриц

Все знают что такое матрица смежности (в ячейке i j хранится информация о рёбрах соединяющих вершины i и j).

Если такую матрицу поместить в ряд 
$$
E + A^1 + A^2 + \dots + A^n + \dots
$$
то мы получим матрицу о маршрутах в графе. Например если это обычная матрица смежности (содержит 0 если ребра и 1 если есть), то результат ряда - матрица, содержащая информации о существовании маршрута между вершинами.

Теперь рассмотрим особенность введённого выше сложения: множество при объединении с собой даёт то же самое множество. Это значит, что 
$$
(E + A)^n = 1 + nA + \dots = 1 + A + \dots
$$

То есть вместо вычисления суммы ряда, можем вычислять степень матрицы $E+A$. Как только найдём $n$ такое, что $(E+A)^n = (E+A)^{(n+1)}$, то сможем сказать что мы нашли результат.

Если в матрицу смежностей поместить все простые списки маршрутов между соотвествующими вершинами, а потом подсчитать $n$ степень этой матрицы, то мы получим матрицу со всеми маршрутами из каждой ячейки в каждую. 

Чтобы избежать многократного прохождения циклов в графе, изменим умножение таким образом, чтобы оно убирало из списка маршшрутов маршруты с повторами.

## Про решение задачи

Наконец, строим матрицу, возводим в степень и извлекаем строки матрицы, соответствующие заданным вершинам. Из этих строк получаем все наборы маршрутов, затем объединяем их в одно множество и находим комбинации, покрывающие все рёбра и имеюще наименьший суммарный вес рёбер.
